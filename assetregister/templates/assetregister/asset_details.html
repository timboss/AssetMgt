{% extends 'assetregister/base.html' %}

    {% block content %}
    
    <ul class="breadcrumb">
		<li><a href="#">Home</a></li>
		<li><a href="{% url 'asset_list' %}">Assets</a></li>
		<li class="active">Details</li>
	</ul>

    
        <div class="asset">
            
            <h2>{{ asset.asset_description }}
            
            {% if user.is_authenticated %}
                <a class="btn btn-default" href="{% url 'asset_edit' pk=asset.pk %}" title="Edit asset"><span class="glyphicon glyphicon-edit gi-1x"></span></a>
            {% endif %}
            {% if request.user.is_superuser %}
                <a class="btn btn-default" href="{% url 'asset_confirm_delete' pk=asset.pk %}" title="Delete asset"><span class="glyphicon glyphicon-trash gi-1x"></span></a>
            {% endif %}
            
            </h2>
            
            <br />
            
            <p>Asset I.D. {{ asset.asset_id }}</p>
            
           	{% if asset.asset_status %}
                <p>Current Staus: {{ asset.asset_status}}</p>
            {% endif %}

            {% if asset.asset_image_thumbnail%}
                	<p><a href="/media/{{ asset.asset_image }}" target="_blank"><img src="/media/{{ asset.asset_image_thumbnail }}"></a></p>
            {% endif %}
            
            
            <!-- big table -->
			<table class="table table-striped">
				<tbody>
					{% if asset.asset_manufacturer %}
						<tr>
							<td class="col-md-3">Manufacturer:</td>
							<td>{{ asset.asset_manufacturer }}</td>
						</tr>
        			{% endif %}
        			
					{% if asset.asset_model %}
						<tr>
							<td class="col-md-3">Model:</td>
							<td>{{ asset.asset_model }}</td>
						</tr>
        			{% endif %}
					
					{% if asset.asset_serial_number %}
						<tr>
							<td class="col-md-3">Serial Number:</td>
							<td>{{ asset.asset_serial_number }}</td>
						</tr>
        			{% endif %}
        			
        			{% if asset.asset_value %}
						<tr>
							<td class="col-md-3">Value:</td>
							<td>Â£{{ asset.asset_value }}</td>
						</tr>
        			{% endif %}
        			
        			{% if asset.purchase_order_ref %}							
        				<tr>
							<td class="col-md-3">PO Ref:</td>
							<td>{{ asset.purchase_order_ref }}</td>
						</tr>
        			{% endif %}
        			
        			{% if asset.funded_by %}
						<tr>
							<td class="col-md-3">Funded By:</td>
							<td>{{ asset.funded_by }}</td>
						</tr>
        			{% endif %}
        			
        			{% if asset.acquired_on %}
						<tr>
							<td class="col-md-3">Acquired On:</td>
							<td>{{ asset.acquired_on }}</td>
						</tr>
        			{% endif %}
        			
        			{% if asset.person_responsible %}
						<tr>
							<td class="col-md-3">Person Responsible:</td>
							<td>{{ asset.person_responsible }}</td>
						</tr>
        			{% endif %}
        			
        			{% if asset.person_responsible_email %}
						<tr>
							<td class="col-md-3">Person Responsible Email:</td>
							<td><a href="mailto:{{ asset.person_responsible_email }}">{{ asset.person_responsible_email }}</a></td>
						</tr>
        			{% endif %}
        			
        			{% if asset.asset_location_building %}
        				<tr>
        					<td class="col-md-3">Location (Building):</td>
        					<td>{{ asset.asset_location_building }}</td>
        				</tr>
        			{% endif %}
        			
        			{% if asset.asset_location_room %}
        				<tr>
        					<td class="col-md-3">Location (Room):</td>
        					<td>{{ asset.asset_location_room }}</td>
        				</tr>
        			{% endif %}
        			
				</tbody>
			</table>
            <br />

            {% if asset.asset_details %}
            	<div class="panel-group">
					<div class="panel panel-default">
					    <div class="panel-heading">
					      <h4 class="panel-title">
					        <a data-toggle="collapse" href="#collapse3">
					        	<div id="calibration-expand-container">
					        		<div id="calibration-expand-left" align="left">Asset Details / Notes</div>
					        		<div id="calibration-expand-right" align="right"><span class=" glyphicon glyphicon-triangle-bottom gi-1x"></span></div>
					        	</div>
					        </a>
					      </h4>
					    </div>
					    <div id="collapse3" class="panel-collapse collapse">
					    	<div class="panel-body">
                				{{ asset.asset_details|linebreaks }}
                			</div>
						</div>
					</div>
				</div>
            {% endif %}
            
            
            {% if asset.requires_calibration %}
            	<hr>
            	<h3>Calibration</h3>
                
              	{% if last_cal %}     				
     				<p><b>
                	{% if last_cal.calibration_outcome == 'Pass' %}
              			Last Calibration Result: <b>Pass <span class="glyphicon glyphicon-ok gi-2x"></span></b>
              		{% else %}
              			Last Calibration Result: <b>Fail <span class="glyphicon glyphicon-remove gi-2x"></span></b>
              		{% endif %}
              		</b></p>
     				<p>Next Calibration Due: {{ last_cal.calibration_date_next }}</p>
     			{% endif %}
     			
     			
	            <div class="panel-group">
	            	{% if last_cal.calibration_outcome == 'Pass' %}
						<div class="panel panel-success">
					{% else %}
						<div class="panel panel-danger">
					{% endif %}
						    <div class="panel-heading">
						      <h4 class="panel-title">
						        <a data-toggle="collapse" href="#collapse1">
						        	<div id="calibration-expand-container">
						        		<div id="calibration-expand-left" align="left">Last 5 Calibration Records</div>
						        		<div id="calibration-expand-right" align="right"><span class=" glyphicon glyphicon-triangle-bottom gi-1x"></span></div>
						        	</div>
						        </a>
						      </h4>
						    </div>
						    <div id="collapse1" class="panel-collapse collapse">
						    	<div class="panel-body">
						    	
						    	{% if calibrations %}
						    		<table class="table table-hover ">
										<thead>
											<tr>
											    <th>Calibration</th>
											    <th>Calibration Date</th>
											    <th>Result</th>
											    <th>Next Calibration Due</th>
											</tr>
										</thead>
										<tbody>
											{% for calibration in calibrations %}
												{% if calibration.calibration_outcome == 'Pass' %}
													<tr>
												{% else %}
													<tr class="danger">
												{% endif %}	
														<td>
															{% if calibration.asset == last_cal.asset %}
															 	<span class="glyphicon glyphicon-asterisk" title="Latest Calibration"></span>
															 {% endif %}
															<a href="{% url 'calibration_detail' pk=calibration.calibration_record_id %}">{{ calibration.calibration_description }}</a>
														</td>
														<td>{{ calibration.calibration_date }}</td>
														<td><b>{{ calibration.calibration_outcome }}</b></td>
														<td>{{ calibration.calibration_date_next }}</td>
													</tr>
											{% endfor %}
										</tbody>
									</table>
								{% else %}
									<h5>No calibration records yet :(</h5>
								{% endif %}	
									
						    	</div>
						    	{% if user.is_authenticated %}
							      	<div class="panel-footer">
							      		<a href="{% url 'new_calibration_asset' urlpk=asset.pk %}">Add Calibration Record</a>
							      	</div>
							    {% endif %}
							</div>
						</div>
					</div>
            {% endif %}
            
            {% if asset.requires_safety_checks %}
            	<hr>
            	<h3>Safety</h3>
                <p>Requires Safety Checks: <span class="glyphicon glyphicon-ok gi-1x"></span></p>
            {% endif %}
            
            {% if asset.requires_environmental_checks or asset.environmental_aspects.all or asset.environmental_notes %}
            	<hr>
            	<h3>Environmental</h3>
           		<div class="panel-group">
					<div class="panel panel-default">
					    <div class="panel-heading">
					      <h4 class="panel-title">
					        <a data-toggle="collapse" href="#collapse4">
					        	<div id="calibration-expand-container">
					        		<div id="calibration-expand-left" align="left">Environmental</div>
					        		<div id="calibration-expand-right" align="right"><span class=" glyphicon glyphicon-triangle-bottom gi-1x"></span></div>
					        	</div>
					        </a>
					      </h4>
					    </div>
					    <div id="collapse4" class="panel-collapse collapse">
					    	<div class="panel-body">
					    		{% if asset.requires_environmental_checks %}
					    			<p>Requires Environmental Checks: <span class="glyphicon glyphicon-ok gi-1x"></span></p>
					    		{% endif %}
					    		
					    		{% if asset.environmental_aspects.all %}
						    		<table class="table table-striped table-hover ">
										<thead>
											<tr>
											    <th>Environmental Aspect</th>
											    <th>Applies To Asset</th>
											</tr>
										</thead>
										<tbody>
											{% for easpect in asset.environmental_aspects.all %}
												<tr>
													<td>{{ easpect.aspect }}</td>
													<td><span class="glyphicon glyphicon-ok gi-2x"></span></td>
												</tr>
											{% endfor %}
										</tbody>
									</table>
								{% endif %}
								
								{% if asset.environmental_notes %}
									<p>
										Environmental Notes:
										<br />{{ asset.environmental_notes|linebreaks }}
									</p>
								{% endif %}
					    	</div>
						</div>
					</div>
				</div>
            {% endif %}
            
            {% if asset.requires_planned_maintenance %}
            	<hr>
            	<h3>Maintenance</h3>
                <p>Requires Planned Preventative Maintenance: <span class="glyphicon glyphicon-ok gi-1x"></span>
               	
               	{% if asset.maintenance_records %}
               		<br /><a href="{{ asset.maintenance_records }}" target="_blank">View Maintenance Records</a>
               	{% endif %}
               	
               	</p>
            {% endif %}
            
            
            {% if asset.parent_assets.all %}
            	<hr>
            	<h3>Related Assets</h3>
           		<div class="panel-group">
					<div class="panel panel-default">
					    <div class="panel-heading">
					      <h4 class="panel-title">
					        <a data-toggle="collapse" href="#collapse2">
					        	<div id="calibration-expand-container">
					        		<div id="calibration-expand-left" align="left">Related To</div>
					        		<div id="calibration-expand-right" align="right"><span class=" glyphicon glyphicon-triangle-bottom gi-1x"></span></div>
					        	</div>
					        </a>
					      </h4>
					    </div>
					    <div id="collapse2" class="panel-collapse collapse">
					    	<div class="panel-body">
					    		<table class="table table-striped table-hover ">
									<thead>
										<tr>
										    <th>Asset I.D.</th>
										    <th>Asset Description</th>
										    <th></th>
										</tr>
									</thead>
									<tbody>
										{% for relative in asset.parent_assets.all %}
											<tr>
												<td><a href="{% url 'asset_detail' pk=relative.asset_id %}">{{ relative.asset_id }}</a></td>
												<td><a href="{% url 'asset_detail' pk=relative.asset_id %}">{{ relative }}</a></td>
												<td><a href="{% url 'asset_detail' pk=relative.asset_id %}"><img src="/media/{{ relative.asset_image_thumbnail }}" width="50%" height="50%"></a></td>
											</tr>
										{% endfor %}
									</tbody>
								</table>
					    	</div>
						</div>
					</div>
				</div>
				<hr>
			{% endif %}
            
            <p>Asset Record Last Edited {{ asset.edited_on }} by {{ asset.edited_by }}</p>
            
            <br /><br />
            
            {% if asset.calibration_instructions %}
                <p><a href="{{ asset.calibration_instructions }}" target="_blank"><span class="glyphicon glyphicon-file gi-1x"></span>  Download Calibration Instructions</a></p>
            {% endif %}    
            
            {% if asset.maintenance_instructions %}
                <p><a href="{{ asset.maintenance_instructions }}" target="_blank"><span class="glyphicon glyphicon-file gi-1x"></span>  Download Maintenance Instructions</a></p>
            {% endif %}
            
            {% if asset.asset_handling_and_storage_instructions %}
                <p><a href="{{ asset.asset_handling_and_storage_instructions }}" target="_blank"><span class="glyphicon glyphicon-file gi-1x"></span>  Download Handling and Storage Instructions</a></p>
            {% endif %}
            
            {% if asset.asset_operating_instructions %}
                <p><a href="{{ asset.asset_operating_instructions }}" target="_blank"><span class="glyphicon glyphicon-file gi-1x"></span>  Download Operating Instructions</a></p>
            {% endif %}            
            
            <br />
            <a href="{% url 'asset_qr' pk=asset.pk %}" target="_blank" class="btn btn-primary btn-sm" onclick="window.open('{% url 'asset_qr' pk=asset.pk %}', 'newwindow', 'width=665, height=310'); return false;"><span class="glyphicon glyphicon-barcode gi-1x"></span>  Generate Large Asset QR Code</a>
            <br /><br />
            <a href="{% url 'asset_qr_small' pk=asset.pk %}" target="_blank" class="btn btn-primary btn-sm" onclick="window.open('{% url 'asset_qr_small' pk=asset.pk %}', 'newwindow2', 'width=130, height=190'); return false;"><span class="glyphicon glyphicon-barcode gi-1x"></span>  Generate Small Asset QR Code</a>
        </div>

    {% endblock %}